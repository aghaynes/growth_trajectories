packages:
  - callr
  - baad.data
  - rmarkdown
  - smatr
  - quantreg
  - plant
  - xtable
  - RColorBrewer

sources:
  - R

plot_options:
  wide:
    width: 12
    height: 4
  square:
    width: 8
    height: 8
  med_square:
    width: 10
    height: 10
  large_square:
    width: 12
    height: 12

include:
  - remake_figures_plant.yml

targets:
  all:
    depends:
      - ms/ms.pdf

  downloads:
    depends:
      - downloads/wright_2004.xls
      - downloads/tree.png
      - downloads/seedling.png

  ms/ms.pdf:
    command: latex_build("ms/ms.tex", bibliography="ms/references.bib", engine=I("xelatex"))
    depends:
      - output/main/table-pars.tex
      - output/main/allometry.pdf
      - output/main/figure_conceptual.pdf
      - output/main/growth_light_dia.pdf
      - output/main/growth_light_mass.pdf
      - output/main/max_leaf_above.pdf
      - output/SI/mass_fraction.pdf
      - output/SI/lma_tradeoff.pdf

      - output/SI/lma_growth_derivative.pdf

      - output/SI/lma_effects_at_heights.pdf
      - output/SI/rho_effects_at_heights.pdf
      - output/SI/hmat_effects_at_heights.pdf
      - output/SI/lma_effects_at_heights_relative.pdf
      - output/SI/rho_effects_at_heights_relative.pdf
      - output/SI/hmat_effects_at_heights_relative.pdf
      - output/SI/lma_effects_at_diameters.pdf
      - output/SI/rho_effects_at_diameters.pdf
      - output/SI/hmat_effects_at_diameters.pdf
      - output/SI/lma_effects_at_diameters_relative.pdf
      - output/SI/rho_effects_at_diameters_relative.pdf
      - output/SI/hmat_effects_at_diameters_relative.pdf

  glopnet:
    command: >
      process_wright_2004("downloads/wright_2004.xls",
                          glopnet_locations)
    packages: xlsx

  downloads/wright_2004.xls:
    download: http://www.nature.com/nature/journal/v428/n6985/extref/nature02403-s2.xls
    cleanup_level: purge
    check: exists

  glopnet_locations:
    command: read.csv("data/wright_2004_locations.csv")

  output/main/table-pars.tex:
    command: table_plant_parameters(plant_parameters, target_name)

  plant_parameters:
    command: read.csv("data/growth_model_pars.csv")

  output/SI/lma_tradeoff.pdf:
    command: figure_lma_tradeoff(glopnet)
    plot: square

  output/main/figure_conceptual.pdf:
    command: latex_build("figure_conceptual.tex", output=target_name, engine=I("xelatex"), clean=TRUE)
    depends:
      - downloads/tree.png
      - downloads/seedling.png
      - output/con/empty_box.pdf
      - output/con/net_mass_production_dt_net_mass_production_dt.pdf
      - output/con/darea_leaf_dmass_live_darea_leaf_dmass_live.pdf
      - output/con/height_dt_height_dt.pdf
      - output/con/area_leaf_dt_area_leaf_dt.pdf
      - output/con/area_stem_dt_area_stem_dt.pdf
      - output/con/diameter_stem_dt_diameter_stem_dt.pdf

  output/con/empty_box.pdf:
    command: empty_box()
    plot: med_square

  downloads/seedling.png:
    download: http://ian.umces.edu/imagelibrary/albums/userpics/10002/normal_ian-symbol-quercus-spp-oak-seedling.png
    cleanup_level: purge

  downloads/tree.png:
    download: http://ian.umces.edu/imagelibrary/albums/userpics/12789/normal_ian-symbol-quercus-montana.png
    cleanup_level: purge

  output/main/allometry.pdf:
    command: figure_assumptions(baad)
    plot: wide

  baad:
    command: baad_data(I("1.0.0"))
