packages:
  - callr
  - baad.data
  - plyr
  - dplyr
  - rmarkdown
  - smatr
  - quantreg
  - plant
  - xtable
  - RColorBrewer

sources:
  - R

plot_options:
  wide:
    width: 12
    height: 4
  square:
    width: 8
    height: 8
  med_square:
    width: 10
    height: 10
  large_square:
    width: 12
    height: 12

include:
  - remake_figures_plant.yml

targets:
  all:
    depends:
      - ms/ms.pdf

  downloads:
    depends:
      - downloads/bci.full.Rdata31Aug2012.zip
      - downloads/wright_2010.txt
      - downloads/wright_2004.xls
      - downloads/tree.png
      - downloads/seedling.png

  ms/ms.pdf:
    command: latex_build("ms/ms.tex", bibliography="ms/references.bib", engine=I("xelatex"))
    depends:
      - output/table-pars.tex
      - output/allometry.pdf
      - output/BCI_data.pdf
      - output/figure_conceptual.pdf
      - output/growth_light_dia.pdf
      - output/growth_light_mass.pdf
      - output/max_leaf_above.pdf
      - output/SI_mass_fraction.pdf
      - output/SI_lma_tradeoff.pdf
      - output/SI_quantile_examples.pdf

      - output/SI_lma_growth_derivative.pdf

      - output/SI_lma_effects_at_heights.pdf
      - output/SI_rho_effects_at_heights.pdf
      - output/SI_hmat_effects_at_heights.pdf
      - output/SI_lma_effects_at_heights_relative.pdf
      - output/SI_rho_effects_at_heights_relative.pdf
      - output/SI_hmat_effects_at_heights_relative.pdf
      - output/SI_lma_effects_at_diameters.pdf
      - output/SI_rho_effects_at_diameters.pdf
      - output/SI_hmat_effects_at_diameters.pdf
      - output/SI_lma_effects_at_diameters_relative.pdf
      - output/SI_rho_effects_at_diameters_relative.pdf
      - output/SI_hmat_effects_at_diameters_relative.pdf

  BCI_species_data:
    command: BCI_calculate_species_traits(BCI_individual_growth, wright_2010)

  BCI_individual_growth:
    command: BCI_calculate_individual_growth(BCI_50haplot, BCI_nomenclature)

  BCI_50haplot:
    command: BCI_load_50ha_plot("downloads/bci.full.Rdata31Aug2012.zip")

  downloads/bci.full.Rdata31Aug2012.zip:
    download: https://repository.si.edu/bitstream/handle/10088/20925/bci.full.Rdata31Aug2012.zip
    cleanup_level: never
    check: exists

  downloads/bci.spptable.rdata:
    download: https://repository.si.edu/bitstream/handle/10088/20925/bci.spptable.rdata
    cleanup_level: never
    check: exists

  BCI_nomenclature:
    command: load_rdata("downloads/bci.spptable.rdata")

  wright_2010:
    command: process_wright_2010("downloads/wright_2010.txt")

  downloads/wright_2010.txt:
    download: http://www.esapubs.org/archive/ecol/E091/257/Supplement_20100505.txt
    cleanup_level: purge
    check: exists

  glopnet:
    command: >
      process_wright_2004("downloads/wright_2004.xls",
                          glopnet_locations)
    packages: xlsx

  downloads/wright_2004.xls:
    download: http://www.nature.com/nature/journal/v428/n6985/extref/nature02403-s2.xls
    cleanup_level: purge
    check: exists

  glopnet_locations:
    command: read.csv("data/wright_2004_locations.csv")

  output/table-pars.tex:
    command: table_plant_parameters(plant_parameters, target_name)

  plant_parameters:
    command: read.csv("data/growth_model_pars.csv")

  output/BCI_data.pdf:
    command: figure_BCI_data2(BCI_species_data)
    plot: wide

  output/SI_quantile_examples.pdf:
    command: figure_qunatile_examples(BCI_individual_growth)
    plot: large_square

  output/SI_lma_tradeoff.pdf:
    command: figure_lma_tradeoff(glopnet)
    plot: square

  output/figure_conceptual.pdf:
    command: latex_build("figure_conceptual.tex", output=target_name, engine=I("xelatex"), clean=TRUE)
    depends:
      - downloads/tree.png
      - downloads/seedling.png
      - output/empty_box.pdf
      - output/F2_net_mass_production_dt_net_mass_production_dt.pdf
      - output/F2_darea_leaf_dmass_live_darea_leaf_dmass_live.pdf
      - output/F2_height_dt_height_dt.pdf
      - output/F2_area_leaf_dt_area_leaf_dt.pdf
      - output/F2_area_stem_dt_area_stem_dt.pdf
      - output/F2_diameter_stem_dt_diameter_stem_dt.pdf

  output/empty_box.pdf:
    command: empty_box()
    plot: med_square

  downloads/seedling.png:
    download: http://ian.umces.edu/imagelibrary/albums/userpics/10002/normal_ian-symbol-quercus-spp-oak-seedling.png
    cleanup_level: purge

  downloads/tree.png:
    download: http://ian.umces.edu/imagelibrary/albums/userpics/12789/normal_ian-symbol-quercus-montana.png
    cleanup_level: purge

  output/allometry.pdf:
    command: figure_assumptions(baad)
    plot: wide

  baad:
    command: baad_data(I("1.0.0"))
